


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > ConversationController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.adnan.travner.controller</a>
</div>

<h1>Coverage Summary for Class: ConversationController (org.adnan.travner.controller)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ConversationController</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    14.3%
  </span>
  <span class="absValue">
    (1/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    1.5%
  </span>
  <span class="absValue">
    (1/65)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.adnan.travner.controller;
&nbsp;
&nbsp;import io.swagger.v3.oas.annotations.Operation;
&nbsp;import io.swagger.v3.oas.annotations.Parameter;
&nbsp;import io.swagger.v3.oas.annotations.tags.Tag;
&nbsp;import jakarta.validation.Valid;
&nbsp;import lombok.RequiredArgsConstructor;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.adnan.travner.dto.ApiResponse;
&nbsp;import org.adnan.travner.dto.chat.*;
&nbsp;import org.adnan.travner.service.ConversationService;
&nbsp;import org.springframework.data.domain.Page;
&nbsp;import org.springframework.data.domain.Pageable;
&nbsp;import org.springframework.data.web.PageableDefault;
&nbsp;import org.springframework.http.HttpStatus;
&nbsp;import org.springframework.http.ResponseEntity;
&nbsp;import org.springframework.security.core.Authentication;
&nbsp;import org.springframework.web.bind.annotation.*;
&nbsp;
&nbsp;/**
&nbsp; * REST Controller for conversation management
&nbsp; */
&nbsp;@RestController
&nbsp;@RequestMapping(&quot;/api/chat/conversations&quot;)
&nbsp;@RequiredArgsConstructor
<b class="fc">&nbsp;@Slf4j</b>
&nbsp;@Tag(name = &quot;Conversations&quot;, description = &quot;Conversation management APIs&quot;)
&nbsp;public class ConversationController {
&nbsp;
&nbsp;        private final ConversationService conversationService;
&nbsp;
&nbsp;        /**
&nbsp;         * Create a new conversation
&nbsp;         */
&nbsp;        @PostMapping
&nbsp;        @Operation(summary = &quot;Create conversation&quot;, description = &quot;Create a new direct or group conversation&quot;)
&nbsp;        public ResponseEntity&lt;ApiResponse&lt;ConversationResponse&gt;&gt; createConversation(
&nbsp;                        @Valid @RequestBody CreateConversationRequest request,
&nbsp;                        Authentication authentication) {
&nbsp;
<b class="nc">&nbsp;                log.debug(&quot;Creating conversation for user: {}&quot;, authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                ConversationResponse conversation = conversationService.createConversation(request,</b>
<b class="nc">&nbsp;                                authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                ApiResponse&lt;ConversationResponse&gt; response = ApiResponse.&lt;ConversationResponse&gt;builder()</b>
<b class="nc">&nbsp;                                .success(true)</b>
<b class="nc">&nbsp;                                .message(&quot;Conversation created successfully&quot;)</b>
<b class="nc">&nbsp;                                .data(conversation)</b>
<b class="nc">&nbsp;                                .build();</b>
&nbsp;
<b class="nc">&nbsp;                return ResponseEntity.status(HttpStatus.CREATED).body(response);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Get or create a DIRECT (one-to-one) conversation between the authenticated
&nbsp;         * user and the specified user
&nbsp;         */
&nbsp;        @GetMapping(&quot;/direct/{otherUserId}&quot;)
&nbsp;        @Operation(summary = &quot;Get or create DIRECT conversation&quot;, description = &quot;Fetch an existing one-to-one conversation with the specified user or create it if it doesn&#39;t exist&quot;)
&nbsp;        public ResponseEntity&lt;ApiResponse&lt;ConversationResponse&gt;&gt; getOrCreateDirectConversation(
&nbsp;                        @Parameter(description = &quot;Other user&#39;s ID or username&quot;) @PathVariable String otherUserId,
&nbsp;                        Authentication authentication) {
&nbsp;
<b class="nc">&nbsp;                log.debug(&quot;Get or create DIRECT conversation between {} and {}&quot;, authentication.getName(),</b>
&nbsp;                                otherUserId);
&nbsp;
&nbsp;                // Delegate to the same create flow; service will reuse if exists
<b class="nc">&nbsp;                var req = CreateConversationRequest.builder()</b>
<b class="nc">&nbsp;                                .type(org.adnan.travner.domain.conversation.Conversation.ConversationType.DIRECT)</b>
<b class="nc">&nbsp;                                .memberIds(java.util.List.of(otherUserId))</b>
<b class="nc">&nbsp;                                .build();</b>
&nbsp;
<b class="nc">&nbsp;                ConversationResponse conversation = conversationService.createConversation(req,</b>
<b class="nc">&nbsp;                                authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                ApiResponse&lt;ConversationResponse&gt; response = ApiResponse.&lt;ConversationResponse&gt;builder()</b>
<b class="nc">&nbsp;                                .success(true)</b>
<b class="nc">&nbsp;                                .message(&quot;DIRECT conversation ready&quot;)</b>
<b class="nc">&nbsp;                                .data(conversation)</b>
<b class="nc">&nbsp;                                .build();</b>
&nbsp;
<b class="nc">&nbsp;                return ResponseEntity.ok(response);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Get user&#39;s conversations with pagination
&nbsp;         */
&nbsp;        @GetMapping
&nbsp;        @Operation(summary = &quot;Get conversations&quot;, description = &quot;Get user&#39;s conversations with pagination&quot;)
&nbsp;        public ResponseEntity&lt;ApiResponse&lt;Page&lt;ConversationResponse&gt;&gt;&gt; getConversations(
&nbsp;                        @Parameter(description = &quot;Pagination parameters&quot;) @PageableDefault(size = 20, sort = &quot;lastMessageAt&quot;) Pageable pageable,
&nbsp;                        Authentication authentication) {
&nbsp;
<b class="nc">&nbsp;                log.debug(&quot;Getting conversations for user: {}&quot;, authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                Page&lt;ConversationResponse&gt; conversations = conversationService.getUserConversations(</b>
<b class="nc">&nbsp;                                authentication.getName(), pageable);</b>
&nbsp;
<b class="nc">&nbsp;                ApiResponse&lt;Page&lt;ConversationResponse&gt;&gt; response = ApiResponse.&lt;Page&lt;ConversationResponse&gt;&gt;builder()</b>
<b class="nc">&nbsp;                                .success(true)</b>
<b class="nc">&nbsp;                                .message(&quot;Conversations retrieved successfully&quot;)</b>
<b class="nc">&nbsp;                                .data(conversations)</b>
<b class="nc">&nbsp;                                .pagination(ApiResponse.PaginationMeta.builder()</b>
<b class="nc">&nbsp;                                                .page(conversations.getNumber())</b>
<b class="nc">&nbsp;                                                .size(conversations.getSize())</b>
<b class="nc">&nbsp;                                                .totalElements(conversations.getTotalElements())</b>
<b class="nc">&nbsp;                                                .totalPages(conversations.getTotalPages())</b>
<b class="nc">&nbsp;                                                .first(conversations.isFirst())</b>
<b class="nc">&nbsp;                                                .last(conversations.isLast())</b>
<b class="nc">&nbsp;                                                .build())</b>
<b class="nc">&nbsp;                                .build();</b>
&nbsp;
<b class="nc">&nbsp;                return ResponseEntity.ok(response);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Get conversation by ID
&nbsp;         */
&nbsp;        @GetMapping(&quot;/{conversationId}&quot;)
&nbsp;        @Operation(summary = &quot;Get conversation&quot;, description = &quot;Get conversation details by ID&quot;)
&nbsp;        public ResponseEntity&lt;ApiResponse&lt;ConversationResponse&gt;&gt; getConversation(
&nbsp;                        @Parameter(description = &quot;Conversation ID&quot;) @PathVariable String conversationId,
&nbsp;                        Authentication authentication) {
&nbsp;
<b class="nc">&nbsp;                log.debug(&quot;Getting conversation: {} for user: {}&quot;, conversationId, authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                ConversationResponse conversation = conversationService.getConversation(conversationId,</b>
<b class="nc">&nbsp;                                authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                ApiResponse&lt;ConversationResponse&gt; response = ApiResponse.&lt;ConversationResponse&gt;builder()</b>
<b class="nc">&nbsp;                                .success(true)</b>
<b class="nc">&nbsp;                                .message(&quot;Conversation retrieved successfully&quot;)</b>
<b class="nc">&nbsp;                                .data(conversation)</b>
<b class="nc">&nbsp;                                .build();</b>
&nbsp;
<b class="nc">&nbsp;                return ResponseEntity.ok(response);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Add members to conversation
&nbsp;         */
&nbsp;        @PostMapping(&quot;/{conversationId}/members&quot;)
&nbsp;        @Operation(summary = &quot;Add members&quot;, description = &quot;Add members to a group conversation&quot;)
&nbsp;        public ResponseEntity&lt;ApiResponse&lt;Void&gt;&gt; addMembers(
&nbsp;                        @Parameter(description = &quot;Conversation ID&quot;) @PathVariable String conversationId,
&nbsp;                        @Valid @RequestBody AddMembersRequest request,
&nbsp;                        Authentication authentication) {
&nbsp;
<b class="nc">&nbsp;                log.debug(&quot;Adding members to conversation: {} by user: {}&quot;, conversationId, authentication.getName());</b>
&nbsp;
&nbsp;                // Set conversation ID from path parameter
<b class="nc">&nbsp;                request.setConversationId(conversationId);</b>
&nbsp;
<b class="nc">&nbsp;                conversationService.addMembers(conversationId, request.getUserIds(), authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                ApiResponse&lt;Void&gt; response = ApiResponse.&lt;Void&gt;builder()</b>
<b class="nc">&nbsp;                                .success(true)</b>
<b class="nc">&nbsp;                                .message(&quot;Members added successfully&quot;)</b>
<b class="nc">&nbsp;                                .build();</b>
&nbsp;
<b class="nc">&nbsp;                return ResponseEntity.ok(response);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Remove member from conversation
&nbsp;         */
&nbsp;        @DeleteMapping(&quot;/{conversationId}/members/{userId}&quot;)
&nbsp;        @Operation(summary = &quot;Remove member&quot;, description = &quot;Remove a member from conversation&quot;)
&nbsp;        public ResponseEntity&lt;ApiResponse&lt;Void&gt;&gt; removeMember(
&nbsp;                        @Parameter(description = &quot;Conversation ID&quot;) @PathVariable String conversationId,
&nbsp;                        @Parameter(description = &quot;User ID to remove&quot;) @PathVariable String userId,
&nbsp;                        Authentication authentication) {
&nbsp;
<b class="nc">&nbsp;                log.debug(&quot;Removing member: {} from conversation: {} by user: {}&quot;,</b>
<b class="nc">&nbsp;                                userId, conversationId, authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                conversationService.removeMember(conversationId, userId, authentication.getName());</b>
&nbsp;
<b class="nc">&nbsp;                ApiResponse&lt;Void&gt; response = ApiResponse.&lt;Void&gt;builder()</b>
<b class="nc">&nbsp;                                .success(true)</b>
<b class="nc">&nbsp;                                .message(&quot;Member removed successfully&quot;)</b>
<b class="nc">&nbsp;                                .build();</b>
&nbsp;
<b class="nc">&nbsp;                return ResponseEntity.ok(response);</b>
&nbsp;        }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-10-08 15:15</div>
</div>
</body>
</html>
